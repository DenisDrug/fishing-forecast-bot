import requests
import re
from datetime import datetime
from typing import Dict, Any, List, Tuple, Optional
import traceback

from .config import config


class AIForecaster:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Groq API"""

    SYSTEM_PROMPT = """
    –¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä—ã–±–∞–ª–∫–µ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä—ã–±–∞–∫ –∏ –∏—Ö—Ç–∏–æ–ª–æ–≥.
    –¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤–Ω—É—Ç—Ä–∏ Telegram-–±–æ—Ç–∞ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã –Ω–∞ 5 –¥–Ω–µ–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–æ API, –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ª–æ–∫–∞—Ü–∏–∏.

    –¢—ã —É—á–∏—Ç—ã–≤–∞–µ—à—å:
    ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞;
    ‚Äî –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ;
    ‚Äî –≤–µ—Ç–µ—Ä (—Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ);
    ‚Äî –æ—Å–∞–¥–∫–∏;
    ‚Äî –æ–±–ª–∞—á–Ω–æ—Å—Ç—å;
    ‚Äî –≤–ª–∞–∂–Ω–æ—Å—Ç—å;
    ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–¥—ã (–µ—Å–ª–∏ –¥–∞–Ω–∞);
    ‚Äî —Å–µ–∑–æ–Ω –≥–æ–¥–∞;
    ‚Äî —Ç–∏–ø –≤–æ–¥–æ—ë–º–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω);
    ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–æ–¥–æ—ë–º–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ).

    –¢–≤–æ—è –∑–∞–¥–∞—á–∞:
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –ø–æ–≥–æ–¥—ã –∏ —Å–µ–∑–æ–Ω–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä—ã–±—ã –∏ –≤—ã–¥–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –∫–ª—ë–≤–∞.

    –†–∞–∑–¥–µ–ª—è–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞:
    ‚Äî üêü –ú–∏—Ä–Ω–∞—è —Ä—ã–±–∞
    ‚Äî ü¶à –•–∏—â–Ω–∞—è —Ä—ã–±–∞

    –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:

    üìç –õ–æ–∫–∞—Ü–∏—è: <–º–µ—Å—Ç–æ>

    üóì –°–µ–∑–æ–Ω: <–≤–µ—Å–Ω–∞ / –ª–µ—Ç–æ / –æ—Å–µ–Ω—å / –∑–∏–º–∞>

    üéØ –û–±—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π:
    –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ (—É–ª—É—á—à–µ–Ω–∏–µ / —É—Ö—É–¥—à–µ–Ω–∏–µ / —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª—ë–≤)

    üêü –ú–∏—Ä–Ω–∞—è —Ä—ã–±–∞:
    –ü—Ä–æ–≥–Ω–æ–∑ –∫–ª—ë–≤–∞: X/10  
    –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

    ü¶à –•–∏—â–Ω–∞—è —Ä—ã–±–∞:
    –ü—Ä–æ–≥–Ω–æ–∑ –∫–ª—ë–≤–∞: X/10  
    –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

    üìä –ö–ª—é—á–µ–≤—ã–µ –ø–æ–≥–æ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:
    - ...
    - ...

    üß∞ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
    - –∫–∞–∫–∏–µ —Å–Ω–∞—Å—Ç–∏
    - –∫–∞–∫–∏–µ –ø—Ä–∏–º–∞–Ω–∫–∏ / –Ω–∞—Å–∞–¥–∫–∏
    - –≤—Ä–µ–º—è —Å—É—Ç–æ–∫

    üìç –ì–¥–µ –∏—Å–∫–∞—Ç—å —Ä—ã–±—É:
    - —Ç–∏–ø–∏—á–Ω—ã–µ —Ç–æ—á–∫–∏

    –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–æ–¥–æ—ë–º–∞ –∏–ª–∏ –µ–≥–æ —Ç–∏–ø –Ω–µ —É–∫–∞–∑–∞–Ω—ã ‚Äî –ø–æ–ø—Ä–æ—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–∏—Ç—å:
    ¬´–£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–∏–ø –≤–æ–¥–æ—ë–º–∞ (—Ä–µ–∫–∞, –æ–∑–µ—Ä–æ, –≤–æ–¥–æ—Ö—Ä–∞–Ω–∏–ª–∏—â–µ). –≠—Ç–æ –ø–æ–≤—ã—Å–∏—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∞.¬ª

    –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã ‚Äî —Å–∫–∞–∂–∏, —á—Ç–æ —Ä–∞—Å—á—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ —Å–µ–∑–æ–Ω–Ω–æ–π —Å—Ä–µ–¥–Ω–µ–π.

    –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –ø–æ–Ω—è—Ç–Ω–æ, –±–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π.
    –ò—Å–ø–æ–ª—å–∑—É–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω –æ–ø—ã—Ç–Ω–æ–≥–æ —Ä—ã–±–∞–∫–∞-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞.
    
    –¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä—ã–±:

    –ú–∏—Ä–Ω–∞—è —Ä—ã–±–∞:
    ‚Äî –ö–∞—Ä–ø, –∫–∞—Ä–∞—Å—å, –ª–µ—â, –ø–ª–æ—Ç–≤–∞ –ª—É—á—à–µ –∫–ª—é—é—Ç –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –ø–æ–≥–æ–¥–µ, —Å–ª–∞–±–æ–º –≤–µ—Ç—Ä–µ –∏ —Ç—ë–ø–ª–æ–π –≤–æ–¥–µ.
    ‚Äî –ü–∞–¥–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–∑–∫–∏–µ –ø–æ—Ö–æ–ª–æ–¥–∞–Ω–∏—è —É—Ö—É–¥—à–∞—é—Ç –∫–ª—ë–≤.
    ‚Äî –£—Ç—Ä–æ –∏ –≤–µ—á–µ—Ä ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è –ø–∏—Ç–∞–Ω–∏—è –ª–µ—Ç–æ–º.
    
    –•–∏—â–Ω–∞—è —Ä—ã–±–∞:
    ‚Äî –©—É–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø—Ä–∏ –ø–∞—Å–º—É—Ä–Ω–æ–π –ø–æ–≥–æ–¥–µ, —É–º–µ—Ä–µ–Ω–Ω–æ–º –≤–µ—Ç—Ä–µ, –ª—ë–≥–∫–æ–º –ø–æ–Ω–∏–∂–µ–Ω–∏–∏ –¥–∞–≤–ª–µ–Ω–∏—è.
    ‚Äî –°—É–¥–∞–∫ –ª—é–±–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–ª–∏ –≤—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–µ–Ω –Ω–æ—á—å—é –∏ –Ω–∞ —Ä–∞—Å—Å–≤–µ—Ç–µ.
    ‚Äî –û–∫—É–Ω—å —Å—Ç–∞–±–∏–ª–µ–Ω –ø—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ–π –ø–æ–≥–æ–¥–µ, —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–º–µ–Ω—É –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏.
    
    –°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å:
    ‚Äî –í–µ—Å–Ω–∞: –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –Ω–µ—Ä–µ—Å—Ç–∞, –ª—É—á—à–∏–π –∫–ª—ë–≤ –ø—Ä–∏ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏.
    ‚Äî –õ–µ—Ç–æ: —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª—ë–≤ —É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º, –¥–Ω—ë–º —Å–Ω–∏–∂–µ–Ω–∏–µ.
    ‚Äî –û—Å–µ–Ω—å: –ø–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ö–∏—â–Ω–∏–∫–∞ –ø—Ä–∏ –ø–æ—Ö–æ–ª–æ–¥–∞–Ω–∏–∏ –≤–æ–¥—ã.
    ‚Äî –ó–∏–º–∞: —Å–Ω–∏–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤—ã—Ö–æ–¥—ã –Ω–∞ –∫–æ—Ä–º—ë–∂–∫—É.
    
    –ï—Å–ª–∏ –≤–∏–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä—ã–±—ã –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –¥–∞–≤–∞–π –ø—Ä–æ–≥–Ω–æ–∑ –æ–±–æ–±—â—ë–Ω–Ω–æ –¥–ª—è –º–∏—Ä–Ω–æ–π –∏ —Ö–∏—â–Ω–æ–π –≥—Ä—É–ø–ø—ã.
    """

    def __init__(self):
        self.api_key = config.GROQ_API_KEY
        self.api_url = config.GROQ_API_URL
        self.model = "llama-3.1-8b-instant"  # –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å Groq

    def _create_user_prompt(self, region: str, weather_data: List[Dict[str, Any]]) -> str:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ò–ò –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        weather_info = []

        for i, day in enumerate(weather_data, 1):
            date = datetime.fromisoformat(day['date']).strftime('%d.%m.%Y')
            weather_info.append(
                f"–î–µ–Ω—å {i} ({date}):\n"
                f"- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {day['temperature']:.1f}¬∞C (–æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ {day['feels_like']:.1f}¬∞C)\n"
                f"- –î–∞–≤–ª–µ–Ω–∏–µ: {day['pressure']} –≥–ü–∞\n"
                f"- –í–ª–∞–∂–Ω–æ—Å—Ç—å: {day['humidity']}%\n"
                f"- –í–µ—Ç–µ—Ä: {day['wind_speed']:.1f} –º/—Å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: {day['wind_direction']}¬∞\n"
                f"- –û–±–ª–∞—á–Ω–æ—Å—Ç—å: {day['cloudiness']}%\n"
                f"- –û—Å–∞–¥–∫–∏: {day['precipitation']:.1f} –º–º\n"
                f"- –û–ø–∏—Å–∞–Ω–∏–µ: {day['description']}\n"
            )

        user_prompt = (
            f"–†–µ–≥–∏–æ–Ω: {region}\n"
            f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π: {len(weather_data)}\n"
            f"–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞: {datetime.now().strftime('%d.%m.%Y %H:%M')}\n\n"
            f"–ü–û–ì–û–î–ù–´–ï –î–ê–ù–ù–´–ï:\n{'-' * 40}\n"
            f"{''.join(weather_info)}\n"
            f"{'-' * 40}\n"
            f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–π –ø—Ä–æ–≥–Ω–æ–∑ –∫–ª–µ–≤–∞."
        )

        return user_prompt

    def _extract_forecast_quality(self, ai_response: str) -> Tuple[Optional[str], Optional[float]]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–µ–≤–∞ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ –ò–ò"""
        try:
            quality_match = re.search(r'–û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê:\s*(\d)/5', ai_response, re.IGNORECASE)
            confidence_match = re.search(r'–£–í–ï–†–ï–ù–ù–û–°–¢–¨:\s*(\d+)%', ai_response, re.IGNORECASE)

            quality_map = {
                '5': '–û—Ç–ª–∏—á–Ω—ã–π',
                '4': '–•–æ—Ä–æ—à–∏–π',
                '3': '–°—Ä–µ–¥–Ω–∏–π',
                '2': '–°–ª–∞–±—ã–π',
                '1': '–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'
            }

            quality = None
            confidence = None

            if quality_match:
                score = quality_match.group(1)
                quality = quality_map.get(score, '–°—Ä–µ–¥–Ω–∏–π')

            if confidence_match:
                confidence = float(confidence_match.group(1))

            return quality, confidence

        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞: {e}")
            return None, None

    def get_forecast(self, region: str, weather_data: List[Dict[str, Any]]) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ –∫–ª–µ–≤–∞ –æ—Ç Groq API"""
        try:
            headers = {
                "Authorization": f"Bearer {self.api_key}",
                "Content-Type": "application/json"
            }

            payload = {
                "model": self.model,
                "messages": [
                    {"role": "system", "content": self.SYSTEM_PROMPT},
                    {"role": "user", "content": self._create_user_prompt(region, weather_data)}
                ],
                "temperature": 0.3,
                "max_tokens": 1500
            }

            print(f"ü§ñ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ —É Groq –¥–ª—è {region}")

            response = requests.post(
                self.api_url,
                headers=headers,
                json=payload,
                timeout=80
            )

            if response.status_code != 200:
                print(f"‚ùå –û—à–∏–±–∫–∞ Groq API: {response.status_code}")
                print(f"–û—Ç–≤–µ—Ç: {response.text[:200]}")
                return self._get_fallback_forecast(region, weather_data)

            result = response.json()
            ai_response = result['choices'][0]['message']['content']

            quality, confidence = self._extract_forecast_quality(ai_response)

            print(f"‚úÖ –ü–æ–ª—É—á–µ–Ω –ø—Ä–æ–≥–Ω–æ–∑ –æ—Ç Groq. –ö–∞—á–µ—Å—Ç–≤–æ: {quality}, –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {confidence}%")

            return {
                "ai_response": ai_response,
                "quality": quality,
                "confidence": confidence or 85.0
            }

        except requests.exceptions.RequestException as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Groq API: {e}")
            return self._get_fallback_forecast(region, weather_data)
        except Exception as e:
            print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Groq: {e}")
            traceback.print_exc()
            return self._get_fallback_forecast(region, weather_data)

    def _get_fallback_forecast(self, region: str, weather_data: List[Dict[str, Any]]) -> Dict[str, Any]:
        """–†–µ–∑–µ—Ä–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Groq API"""
        print(f"‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è {region}")

        scores = []

        for day in weather_data:
            score = 3.0

            if 1013 <= day['pressure'] <= 1017:
                score += 0.5
            elif day['pressure'] < 1000:
                score -= 1.0
            elif day['pressure'] > 1020:
                score -= 0.5

            if 15 <= day['temperature'] <= 25:
                score += 0.5
            elif day['temperature'] < 5 or day['temperature'] > 30:
                score -= 1.0

            if day['wind_speed'] > 6:
                score -= 0.5

            if 0.1 <= day['precipitation'] <= 5:
                score += 0.3
            elif day['precipitation'] > 10:
                score -= 0.5

            scores.append(max(1.0, min(5.0, score)))

        avg_score = sum(scores) / len(scores)

        if avg_score >= 4.5:
            quality = "–û—Ç–ª–∏—á–Ω—ã–π"
        elif avg_score >= 3.5:
            quality = "–•–æ—Ä–æ—à–∏–π"
        elif avg_score >= 2.5:
            quality = "–°—Ä–µ–¥–Ω–∏–π"
        elif avg_score >= 1.5:
            quality = "–°–ª–∞–±—ã–π"
        else:
            quality = "–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"

        response_lines = [
            f"–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞: {region}",
            "",
            f"üìä –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê: {avg_score:.1f}/5 - {quality}",
            "üéØ –£–í–ï–†–ï–ù–ù–û–°–¢–¨: 70%",
            "",
            "üìÖ –ü–†–û–ì–ù–û–ó –ü–û –î–ù–Ø–ú:"
        ]

        for i, (day, score) in enumerate(zip(weather_data, scores), 1):
            date = datetime.fromisoformat(day['date']).strftime('%d.%m')
            response_lines.append(
                f"{i}. {date}: {score:.1f}/5 - "
                f"–¢–µ–º–ø: {day['temperature']:.1f}¬∞C, –î–∞–≤–ª–µ–Ω–∏–µ: {day['pressure']} –≥–ü–∞"
            )

        response_lines.extend([
            "",
            "‚ö° –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ö–¢–û–†–´:",
            "‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (Groq API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)",
            "‚Ä¢ –£—á–∏—Ç—ã–≤–∞–ª–∏—Å—å: –¥–∞–≤–ª–µ–Ω–∏–µ, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–µ—Ç–µ—Ä, –æ—Å–∞–¥–∫–∏",
            "",
            "üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:",
            "‚Ä¢ –°–∏—Å—Ç–µ–º–∞ Groq API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞",
            "‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –ø–æ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É",
            "",
            "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞ –ò–ò"
        ])

        ai_response = "\n".join(response_lines)

        return {
            "ai_response": ai_response,
            "quality": quality,
            "confidence": 70.0
        }


# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ò–ò-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤—â–∏–∫–∞
ai_forecaster = AIForecaster()